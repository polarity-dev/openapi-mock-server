"use strict";var e=require("express"),t=require("express-openapi-validator"),r=require("@apidevtools/json-schema-ref-parser"),n=require("body-parser"),a=require("json-schema-ref-parser"),i=require("axios"),o=require("cors"),s=require("path"),u=require("valid-url"),l=require("debug"),c=require("path-to-regexp"),p=require("statuses"),f=require("inherits"),h=require("jsonschema");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function m(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var y=d(e),g=d(r),v=d(n),b=d(a),x=d(i),w=d(o),O=d(u),E=d(l),F=d(c),j=d(p),k=d(f);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function A(e,t,r,n){return new(r||(r=Promise))((function(a,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))}function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function D(e,t,r){return(D=S()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&R(a,r.prototype),a}).apply(null,arguments)}function C(e){var t="function"==typeof Map?new Map:void 0;return(C=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return D(e,arguments,_(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),R(n,e)})(e)}function I(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function M(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var T=Object.prototype.hasOwnProperty;B.nodeVMSupported=function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}();var N=B.nodeVMSupported?require("vm"):{runInNewContext:function(e,t){var r=Object.keys(t),n=[];!function(e,t,r){for(var n=e.length,a=0;a<n;a++)r(e[a])&&t.push(e.splice(a--,1)[0])}(r,n,(function(e){return"function"==typeof t[e]}));var a=r.map((function(e,r){return t[e]}));(e=n.reduce((function(e,r){var n=t[r].toString();return/function/.exec(n)||(n="function "+n),"var "+r+"="+n+";"+e}),"")+e).match(/(["'])use strict\1/)||r.includes("arguments")||(e="var arguments = undefined;"+e);var i=(e=e.replace(/;[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*$/,"")).lastIndexOf(";"),o=i>-1?e.slice(0,i+1)+" return "+e.slice(i+1):" return "+e;return D(Function,M(r).concat([o])).apply(void 0,M(a))}};function $(e,t){return(e=e.slice()).push(t),e}function q(e,t){return(t=t.slice()).unshift(e),t}var L=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=I(this,_(t).call(this,'JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'))).avoidNew=!0,r.value=e,r.name="NewError",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,C(Error)),t}();function B(e,t,r,n,a){if(!(this instanceof B))try{return new B(e,t,r,n,a)}catch(e){if(!e.avoidNew)throw e;return e.value}"string"==typeof e&&(a=n,n=r,r=t,t=e,e=null);var i=e&&"object"===P(e);if(e=e||{},this.json=e.json||r,this.path=e.path||t,this.resultType=e.resultType&&e.resultType.toLowerCase()||"value",this.flatten=e.flatten||!1,this.wrap=!T.call(e,"wrap")||e.wrap,this.sandbox=e.sandbox||{},this.preventEval=e.preventEval||!1,this.parent=e.parent||null,this.parentProperty=e.parentProperty||null,this.callback=e.callback||n||null,this.otherTypeCallback=e.otherTypeCallback||a||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},!1!==e.autostart){var o={path:i?e.path:t};i?"json"in e&&(o.json=e.json):o.json=r;var s=this.evaluate(o);if(!s||"object"!==P(s))throw new L(s);return s}}B.prototype.evaluate=function(e,t,r,n){var a=this,i=this.parent,o=this.parentProperty,s=this.flatten,u=this.wrap;if(this.currResultType=this.resultType,this.currPreventEval=this.preventEval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=n||this.otherTypeCallback,t=t||this.json,(e=e||this.path)&&"object"===P(e)&&!Array.isArray(e)){if(!e.path)throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!("json"in e))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');t=T.call(e,"json")?e.json:t,s=T.call(e,"flatten")?e.flatten:s,this.currResultType=T.call(e,"resultType")?e.resultType:this.currResultType,this.currSandbox=T.call(e,"sandbox")?e.sandbox:this.currSandbox,u=T.call(e,"wrap")?e.wrap:u,this.currPreventEval=T.call(e,"preventEval")?e.preventEval:this.currPreventEval,r=T.call(e,"callback")?e.callback:r,this.currOtherTypeCallback=T.call(e,"otherTypeCallback")?e.otherTypeCallback:this.currOtherTypeCallback,i=T.call(e,"parent")?e.parent:i,o=T.call(e,"parentProperty")?e.parentProperty:o,e=e.path}if(i=i||null,o=o||null,Array.isArray(e)&&(e=B.toPathString(e)),e&&t){this._obj=t;var l=B.toPathArray(e);"$"===l[0]&&l.length>1&&l.shift(),this._hasParentSelector=null;var c=this._trace(l,t,["$"],i,o,r).filter((function(e){return e&&!e.isParentSelector}));return c.length?u||1!==c.length||c[0].hasArrExpr?c.reduce((function(e,t){var r=a._getPreferredOutput(t);return s&&Array.isArray(r)?e=e.concat(r):e.push(r),e}),[]):this._getPreferredOutput(c[0]):u?[]:void 0}},B.prototype._getPreferredOutput=function(e){var t=this.currResultType;switch(t){default:throw new TypeError("Unknown result type");case"all":return e.pointer=B.toPointer(e.path),e.path="string"==typeof e.path?e.path:B.toPathString(e.path),e;case"value":case"parent":case"parentProperty":return e[t];case"path":return B.toPathString(e[t]);case"pointer":return B.toPointer(e.path)}},B.prototype._handleCallback=function(e,t,r){if(t){var n=this._getPreferredOutput(e);e.path="string"==typeof e.path?e.path:B.toPathString(e.path),t(n,r,e)}},B.prototype._trace=function(e,t,r,n,a,i,o,s){var u,l=this;if(!e.length)return u={path:r,value:t,parent:n,parentProperty:a,hasArrExpr:o},this._handleCallback(u,i,"value"),u;var c=e[0],p=e.slice(1),f=[];function h(e){Array.isArray(e)?e.forEach((function(e){f.push(e)})):f.push(e)}if(("string"!=typeof c||s)&&t&&T.call(t,c))h(this._trace(p,t[c],$(r,c),t,c,i,o));else if("*"===c)this._walk(c,p,t,r,n,a,i,(function(e,t,r,n,a,i,o,s){h(l._trace(q(e,r),n,a,i,o,s,!0,!0))}));else if(".."===c)h(this._trace(p,t,r,n,a,i,o)),this._walk(c,p,t,r,n,a,i,(function(e,t,r,n,a,i,o,s){"object"===P(n[e])&&h(l._trace(q(t,r),n[e],$(a,e),n,e,s,!0))}));else{if("^"===c)return this._hasParentSelector=!0,r.length?{path:r.slice(0,-1),expr:p,isParentSelector:!0}:[];if("~"===c)return u={path:$(r,c),value:a,parent:n,parentProperty:null},this._handleCallback(u,i,"property"),u;if("$"===c)h(this._trace(p,t,r,null,null,i,o));else if(/^(\x2D?[0-9]*):(\x2D?[0-9]*):?([0-9]*)$/.test(c))h(this._slice(c,p,t,r,n,a,i));else if(0===c.indexOf("?(")){if(this.currPreventEval)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");this._walk(c,p,t,r,n,a,i,(function(e,t,r,n,a,i,o,s){l._eval(t.replace(/^\?\(((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?)\)$/,"$1"),n[e],e,a,i,o)&&h(l._trace(q(e,r),n,a,i,o,s,!0))}))}else if("("===c[0]){if(this.currPreventEval)throw new Error("Eval [(expr)] prevented in JSONPath expression.");h(this._trace(q(this._eval(c,t,r[r.length-1],r.slice(0,-1),n,a),p),t,r,n,a,i,o))}else if("@"===c[0]){var d=!1,m=c.slice(1,-2);switch(m){default:throw new TypeError("Unknown value type "+m);case"scalar":t&&["object","function"].includes(P(t))||(d=!0);break;case"boolean":case"string":case"undefined":case"function":P(t)===m&&(d=!0);break;case"number":P(t)===m&&isFinite(t)&&(d=!0);break;case"nonFinite":"number"!=typeof t||isFinite(t)||(d=!0);break;case"object":t&&P(t)===m&&(d=!0);break;case"array":Array.isArray(t)&&(d=!0);break;case"other":d=this.currOtherTypeCallback(t,r,n,a);break;case"integer":t!==Number(t)||!isFinite(t)||t%1||(d=!0);break;case"null":null===t&&(d=!0)}if(d)return u={path:r,value:t,parent:n,parentProperty:a},this._handleCallback(u,i,"value"),u}else if("`"===c[0]&&t&&T.call(t,c.slice(1))){var y=c.slice(1);h(this._trace(p,t[y],$(r,y),t,y,i,o,!0))}else if(c.includes(",")){var g=c.split(","),v=!0,b=!1,x=void 0;try{for(var w,O=g[Symbol.iterator]();!(v=(w=O.next()).done);v=!0){var E=w.value;h(this._trace(q(E,p),t,r,n,a,i,!0))}}catch(e){b=!0,x=e}finally{try{v||null==O.return||O.return()}finally{if(b)throw x}}}else!s&&t&&T.call(t,c)&&h(this._trace(p,t[c],$(r,c),t,c,i,o,!0))}if(this._hasParentSelector)for(var F=0;F<f.length;F++){var j=f[F];if(j&&j.isParentSelector){var k=l._trace(j.expr,t,j.path,n,a,i,o);if(Array.isArray(k)){f[F]=k[0];for(var A=k.length,_=1;_<A;_++)F++,f.splice(F,0,k[_])}else f[F]=k}}return f},B.prototype._walk=function(e,t,r,n,a,i,o,s){if(Array.isArray(r))for(var u=r.length,l=0;l<u;l++)s(l,e,t,r,n,a,i,o);else if("object"===P(r))for(var c in r)T.call(r,c)&&s(c,e,t,r,n,a,i,o)},B.prototype._slice=function(e,t,r,n,a,i,o){if(Array.isArray(r)){var s=r.length,u=e.split(":"),l=u[2]&&parseInt(u[2])||1,c=u[0]&&parseInt(u[0])||0,p=u[1]&&parseInt(u[1])||s;c=c<0?Math.max(0,c+s):Math.min(s,c),p=p<0?Math.max(0,p+s):Math.min(s,p);for(var f=[],h=c;h<p;h+=l){this._trace(q(h,t),r,n,a,i,o,!0).forEach((function(e){f.push(e)}))}return f}},B.prototype._eval=function(e,t,r,n,a,i){if(!this._obj||!t)return!1;e.includes("@parentProperty")&&(this.currSandbox._$_parentProperty=i,e=e.replace(/@parentProperty/g,"_$_parentProperty")),e.includes("@parent")&&(this.currSandbox._$_parent=a,e=e.replace(/@parent/g,"_$_parent")),e.includes("@property")&&(this.currSandbox._$_property=r,e=e.replace(/@property/g,"_$_property")),e.includes("@path")&&(this.currSandbox._$_path=B.toPathString(n.concat([r])),e=e.replace(/@path/g,"_$_path")),e.includes("@root")&&(this.currSandbox._$_root=this.json,e=e.replace(/@root/g,"_$_root")),e.match(/@([\t-\r \)\.\[\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])/)&&(this.currSandbox._$_v=t,e=e.replace(/@([\t-\r \)\.\[\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])/g,"_$_v$1"));try{return N.runInNewContext(e,this.currSandbox)}catch(t){throw console.log(t),new Error("jsonPath: "+t.message+": "+e)}},B.cache={},B.toPathString=function(e){for(var t=e,r=t.length,n="$",a=1;a<r;a++)/^(~|\^|@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\(\))$/.test(t[a])||(n+=/^[\*0-9]+$/.test(t[a])?"["+t[a]+"]":"['"+t[a]+"']");return n},B.toPointer=function(e){for(var t=e,r=t.length,n="",a=1;a<r;a++)/^(~|\^|@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\(\))$/.test(t[a])||(n+="/"+t[a].toString().replace(/~/g,"~0").replace(/\//g,"~1"));return n},B.toPathArray=function(e){var t=B.cache;if(t[e])return t[e].concat();var r=[],n=e.replace(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/g,";$&;").replace(/['\[](\??\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\))['\]]/g,(function(e,t){return"[#"+(r.push(t)-1)+"]"})).replace(/\['((?:[\0-&\(-\\\^-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)'\]/g,(function(e,t){return"['"+t.replace(/\./g,"%@%").replace(/~/g,"%%@@%%")+"']"})).replace(/~/g,";~;").replace(/'?\.'?(?!(?:[\0-Z\\-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*\])|\['?/g,";").replace(/%@%/g,".").replace(/%%@@%%/g,"~").replace(/(?:;)?(\^+)(?:;)?/g,(function(e,t){return";"+t.split("").join(";")+";"})).replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").split(";").map((function(e){var t=e.match(/#([0-9]+)/);return t&&t[1]?r[t[1]]:e}));return t[e]=n,t[e]};var H=function(){this.data={}};H.prototype.unregister=function(e){e?delete this.data[e]:this.data={}},H.prototype.register=function(e,t){this.data[e]=t},H.prototype.registerMany=function(e){var t=this;Object.keys(e).forEach((function(r){t.data[r]=e[r]}))},H.prototype.get=function(e){return this.data[e]},H.prototype.list=function(){return this.data};var V={defaultInvalidTypeProduct:void 0,defaultRandExpMax:10,ignoreProperties:[],ignoreMissingRefs:!1,failOnInvalidTypes:!0,failOnInvalidFormat:!0,alwaysFakeOptionals:!1,optionalsProbability:null,fixedProbabilities:!1,useExamplesValue:!1,useDefaultValue:!1,requiredOnly:!1,minItems:0,maxItems:null,minLength:0,maxLength:null,resolveJsonPath:!1,reuseProperties:!1,fillProperties:!0,replaceEmptyByRandomValue:!1};V.random=Math.random;var J=new(function(e){function t(){e.call(this),this.data=Object.assign({},V),this._defaults=V}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={defaults:{configurable:!0}};return r.defaults.get=function(){return Object.assign({},this._defaults)},Object.defineProperties(t.prototype,r),t}(H));function U(e,t){return"string"==typeof e?void 0!==t?J.register(e,t):J.get(e):J.registerMany(e)}U.getDefaults=function(){return J.defaults};var z=["integer","number","string","boolean","null"],G={SCALAR_TYPES:z,ALL_TYPES:["array","object"].concat(z),MIN_NUMBER:-100,MAX_NUMBER:100,MIN_INTEGER:-1e8,MAX_INTEGER:1e8,MOST_NEAR_DATETIME:2524608e6};var Z={ROOT:0,GROUP:1,POSITION:2,SET:3,RANGE:4,REPETITION:5,REFERENCE:6,CHAR:7};const X=()=>[{type:Z.RANGE,from:48,to:57}],Y=()=>[{type:Z.CHAR,value:95},{type:Z.RANGE,from:97,to:122},{type:Z.RANGE,from:65,to:90}].concat(X()),W=()=>[{type:Z.CHAR,value:9},{type:Z.CHAR,value:10},{type:Z.CHAR,value:11},{type:Z.CHAR,value:12},{type:Z.CHAR,value:13},{type:Z.CHAR,value:32},{type:Z.CHAR,value:160},{type:Z.CHAR,value:5760},{type:Z.RANGE,from:8192,to:8202},{type:Z.CHAR,value:8232},{type:Z.CHAR,value:8233},{type:Z.CHAR,value:8239},{type:Z.CHAR,value:8287},{type:Z.CHAR,value:12288},{type:Z.CHAR,value:65279}];var K,Q=()=>({type:Z.SET,set:Y(),not:!1}),ee=()=>({type:Z.SET,set:Y(),not:!0}),te=()=>({type:Z.SET,set:X(),not:!1}),re=()=>({type:Z.SET,set:X(),not:!0}),ne=()=>({type:Z.SET,set:W(),not:!1}),ae=()=>({type:Z.SET,set:W(),not:!0}),ie=()=>({type:Z.SET,set:[{type:Z.CHAR,value:10},{type:Z.CHAR,value:13},{type:Z.CHAR,value:8232},{type:Z.CHAR,value:8233}],not:!0}),oe=(function(e,t){const r={0:0,t:9,n:10,v:11,f:12,r:13};t.strToChars=function(e){return e=e.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|(0?[0-7]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(function(e,t,n,a,i,o,s,u){if(n)return e;var l=t?8:a?parseInt(a,16):i?parseInt(i,16):o?parseInt(o,8):s?"@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(s):r[u],c=String.fromCharCode(l);return/[[\]{}^$.|?*+()]/.test(c)&&(c="\\"+c),c}))},t.tokenizeClass=(e,r)=>{for(var n,a,i=[],o=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(?:\\)?([^\]]))|(\])|(?:\\)?([^])/g;null!=(n=o.exec(e));)if(n[1])i.push(Q());else if(n[2])i.push(te());else if(n[3])i.push(ne());else if(n[4])i.push(ee());else if(n[5])i.push(re());else if(n[6])i.push(ae());else if(n[7])i.push({type:Z.RANGE,from:(n[8]||n[9]).charCodeAt(0),to:n[10].charCodeAt(0)});else{if(!(a=n[12]))return[i,o.lastIndex];i.push({type:Z.CHAR,value:a.charCodeAt(0)})}t.error(r,"Unterminated character class")},t.error=(e,t)=>{throw new SyntaxError("Invalid regular expression: /"+e+"/: "+t)}}(K={exports:{}},K.exports),K.exports),se=(oe.strToChars,oe.tokenizeClass,oe.error,()=>({type:Z.POSITION,value:"b"})),ue=()=>({type:Z.POSITION,value:"B"}),le=()=>({type:Z.POSITION,value:"^"}),ce=()=>({type:Z.POSITION,value:"$"}),pe=e=>{var t,r,n=0,a={type:Z.ROOT,stack:[]},i=a,o=a.stack,s=[],u=t=>{oe.error(e,"Nothing to repeat at column "+(t-1))},l=oe.strToChars(e);for(t=l.length;n<t;)switch(r=l[n++]){case"\\":switch(r=l[n++]){case"b":o.push(se());break;case"B":o.push(ue());break;case"w":o.push(Q());break;case"W":o.push(ee());break;case"d":o.push(te());break;case"D":o.push(re());break;case"s":o.push(ne());break;case"S":o.push(ae());break;default:/\d/.test(r)?o.push({type:Z.REFERENCE,value:parseInt(r,10)}):o.push({type:Z.CHAR,value:r.charCodeAt(0)})}break;case"^":o.push(le());break;case"$":o.push(ce());break;case"[":var c;"^"===l[n]?(c=!0,n++):c=!1;var p=oe.tokenizeClass(l.slice(n),e);n+=p[1],o.push({type:Z.SET,set:p[0],not:c});break;case".":o.push(ie());break;case"(":var f={type:Z.GROUP,stack:[],remember:!0};"?"===(r=l[n])&&(r=l[n+1],n+=2,"="===r?f.followedBy=!0:"!"===r?f.notFollowedBy=!0:":"!==r&&oe.error(e,`Invalid group, character '${r}' after '?' at column `+(n-1)),f.remember=!1),o.push(f),s.push(i),i=f,o=f.stack;break;case")":0===s.length&&oe.error(e,"Unmatched ) at column "+(n-1)),o=(i=s.pop()).options?i.options[i.options.length-1]:i.stack;break;case"|":i.options||(i.options=[i.stack],delete i.stack);var h=[];i.options.push(h),o=h;break;case"{":var d,m,y=/^(\d+)(,(\d+)?)?\}/.exec(l.slice(n));null!==y?(0===o.length&&u(n),d=parseInt(y[1],10),m=y[2]?y[3]?parseInt(y[3],10):1/0:d,n+=y[0].length,o.push({type:Z.REPETITION,min:d,max:m,value:o.pop()})):o.push({type:Z.CHAR,value:123});break;case"?":0===o.length&&u(n),o.push({type:Z.REPETITION,min:0,max:1,value:o.pop()});break;case"+":0===o.length&&u(n),o.push({type:Z.REPETITION,min:1,max:1/0,value:o.pop()});break;case"*":0===o.length&&u(n),o.push({type:Z.REPETITION,min:0,max:1/0,value:o.pop()});break;default:o.push({type:Z.CHAR,value:r.charCodeAt(0)})}return 0!==s.length&&oe.error(e,"Unterminated group"),a};pe.types=Z;class fe{constructor(e,t){this.low=e,this.high=t,this.length=1+t-e}overlaps(e){return!(this.high<e.low||this.low>e.high)}touches(e){return!(this.high+1<e.low||this.low-1>e.high)}add(e){return new fe(Math.min(this.low,e.low),Math.max(this.high,e.high))}subtract(e){return e.low<=this.low&&e.high>=this.high?[]:e.low>this.low&&e.high<this.high?[new fe(this.low,e.low-1),new fe(e.high+1,this.high)]:e.low<=this.low?[new fe(e.high+1,this.high)]:[new fe(this.low,e.low-1)]}toString(){return this.low==this.high?this.low.toString():this.low+"-"+this.high}}class he{constructor(e,t){this.ranges=[],this.length=0,null!=e&&this.add(e,t)}_update_length(){this.length=this.ranges.reduce(((e,t)=>e+t.length),0)}add(e,t){var r=e=>{for(var t=0;t<this.ranges.length&&!e.touches(this.ranges[t]);)t++;for(var r=this.ranges.slice(0,t);t<this.ranges.length&&e.touches(this.ranges[t]);)e=e.add(this.ranges[t]),t++;r.push(e),this.ranges=r.concat(this.ranges.slice(t)),this._update_length()};return e instanceof he?e.ranges.forEach(r):(null==t&&(t=e),r(new fe(e,t))),this}subtract(e,t){var r=e=>{for(var t=0;t<this.ranges.length&&!e.overlaps(this.ranges[t]);)t++;for(var r=this.ranges.slice(0,t);t<this.ranges.length&&e.overlaps(this.ranges[t]);)r=r.concat(this.ranges[t].subtract(e)),t++;this.ranges=r.concat(this.ranges.slice(t)),this._update_length()};return e instanceof he?e.ranges.forEach(r):(null==t&&(t=e),r(new fe(e,t))),this}intersect(e,t){var r=[],n=e=>{for(var t=0;t<this.ranges.length&&!e.overlaps(this.ranges[t]);)t++;for(;t<this.ranges.length&&e.overlaps(this.ranges[t]);){var n=Math.max(this.ranges[t].low,e.low),a=Math.min(this.ranges[t].high,e.high);r.push(new fe(n,a)),t++}};return e instanceof he?e.ranges.forEach(n):(null==t&&(t=e),n(new fe(e,t))),this.ranges=r,this._update_length(),this}index(e){for(var t=0;t<this.ranges.length&&this.ranges[t].length<=e;)e-=this.ranges[t].length,t++;return this.ranges[t].low+e}toString(){return"[ "+this.ranges.join(", ")+" ]"}clone(){return new he(this)}numbers(){return this.ranges.reduce(((e,t)=>{for(var r=t.low;r<=t.high;)e.push(r),r++;return e}),[])}subranges(){return this.ranges.map((e=>({low:e.low,high:e.high,length:1+e.high-e.low})))}}var de=he;const me=pe.types;var ye=class e{constructor(e,t){if(this._setDefaults(e),e instanceof RegExp)this.ignoreCase=e.ignoreCase,this.multiline=e.multiline,e=e.source;else{if("string"!=typeof e)throw new Error("Expected a regexp or string");this.ignoreCase=t&&-1!==t.indexOf("i"),this.multiline=t&&-1!==t.indexOf("m")}this.tokens=pe(e)}_setDefaults(t){this.max=null!=t.max?t.max:null!=e.prototype.max?e.prototype.max:100,this.defaultRange=t.defaultRange?t.defaultRange:this.defaultRange.clone(),t.randInt&&(this.randInt=t.randInt)}gen(){return this._gen(this.tokens,[])}_gen(e,t){var r,n,a,i,o;switch(e.type){case me.ROOT:case me.GROUP:if(e.followedBy||e.notFollowedBy)return"";for(e.remember&&void 0===e.groupNumber&&(e.groupNumber=t.push(null)-1),n="",i=0,o=(r=e.options?this._randSelect(e.options):e.stack).length;i<o;i++)n+=this._gen(r[i],t);return e.remember&&(t[e.groupNumber]=n),n;case me.POSITION:return"";case me.SET:var s=this._expand(e);return s.length?String.fromCharCode(this._randSelect(s)):"";case me.REPETITION:for(a=this.randInt(e.min,e.max===1/0?e.min+this.max:e.max),n="",i=0;i<a;i++)n+=this._gen(e.value,t);return n;case me.REFERENCE:return t[e.value-1]||"";case me.CHAR:var u=this.ignoreCase&&this._randBool()?this._toOtherCase(e.value):e.value;return String.fromCharCode(u)}}_toOtherCase(e){return e+(97<=e&&e<=122?-32:65<=e&&e<=90?32:0)}_randBool(){return!this.randInt(0,1)}_randSelect(e){return e instanceof de?e.index(this.randInt(0,e.length-1)):e[this.randInt(0,e.length-1)]}_expand(e){if(e.type===pe.types.CHAR)return new de(e.value);if(e.type===pe.types.RANGE)return new de(e.from,e.to);{let t=new de;for(let r=0;r<e.set.length;r++){let n=this._expand(e.set[r]);if(t.add(n),this.ignoreCase)for(let e=0;e<n.length;e++){let r=n.index(e),a=this._toOtherCase(r);r!==a&&t.add(a)}}return e.not?this.defaultRange.clone().subtract(t):this.defaultRange.clone().intersect(t)}}randInt(e,t){return e+Math.floor(Math.random()*(1+t-e))}get defaultRange(){return this._range=this._range||new de(32,126)}set defaultRange(e){this._range=e}static randexp(t,r){var n;return"string"==typeof t&&(t=new RegExp(t,r)),void 0===t._randexp?(n=new e(t,r),t._randexp=n):(n=t._randexp)._setDefaults(t),n.gen()}static sugar(){RegExp.prototype.gen=function(){return e.randexp(this)}}};function ge(e,t,r,n,a){return void 0===a&&(a=!1),r=void 0===r?G.MIN_NUMBER:r,n=void 0===n?G.MAX_NUMBER:n,(t=void 0===t?n:t)<(e=void 0===e?r:e)&&(t+=e),a?function(e,t){return U("random")()*(t-e)+e}(e,t):function(e,t){return e=void 0===e?G.MIN_INTEGER:e,t=void 0===t?G.MAX_INTEGER:t,Math.floor(U("random")()*(t-e+1))+e}(e,t)}var ve={pick:function(e){return e[Math.floor(U("random")()*e.length)]},date:function(e){if(e)return function(e){switch(e){case"seconds":return 60*ge(0,60);case"minutes":return 612*ge(15,50);case"hours":return 36123*ge(12,72);case"days":return 86412345*ge(7,30);case"weeks":return 604812345*ge(4,52);case"months":return 2592012345*ge(2,13);case"years":return 31104012345*ge(1,20)}}(e);var t=new Date,r=ge(-1e3,G.MOST_NEAR_DATETIME);return t.setTime(t.getTime()-r),t},shuffle:function(e){for(var t,r,n=e.length,a=e.slice();n>0;)r=Math.floor(U("random")()*n),t=a[n-=1],a[n]=a[r],a[r]=t;return a},number:ge,randexp:function(e){return ye.prototype.max=U("defaultRandExpMax"),ye.prototype.randInt=function(e,t){return e+Math.floor(U("random")()*(t-e+1))},new ye(e).gen()}};function be(e,t){return Object.keys(t).forEach((function(r){"object"!=typeof t[r]||null===t[r]?e[r]=t[r]:Array.isArray(t[r])?(e[r]=e[r]||[],t[r].forEach((function(t){Array.isArray(e[r])&&-1===e[r].indexOf(t)&&e[r].push(t)}))):"object"!=typeof e[r]||null===e[r]||Array.isArray(e[r])?e[r]=be({},t[r]):e[r]=be(e[r],t[r])})),e}function xe(){return ve.pick([!1,!0,null,-1,NaN,Math.PI,1/0,void 0,[],{},Math.random(),Math.random().toString(36).substr(2)])}function we(e,t){var r=void 0!==t.minimum,n=void 0!==t.maximum;return(r||n)&&(!r||e>=t.minimum)&&(!n||e<=t.maximum)}function Oe(e){return"[object Object]"===Object.prototype.toString.call(e)&&!Object.keys(e).length}function Ee(e,t){var r=Array.isArray(t.required)&&t.required.includes(e),n="function"==typeof t.thunk||t.additionalProperties&&"function"==typeof t.additionalProperties.thunk;return!r&&!n}var Fe={hasProperties:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return t.filter((function(t){return void 0!==e[t]})).length>0},getLocalRef:function(e,t){for(var r=t.replace(/^.*#\//,"").split("/");r.length;){var n=r.shift();if(!e[n])throw new Error("Prop '"+n+"' not found in ["+Object.keys(e).join(", ")+"] ("+t+")");e=e[n]}return e},omitProps:function(e,t){return Object.keys(e).filter((function(e){return!t.includes(e)})).reduce((function(t,r){return Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]instanceof Object?be({},e[r]):e[r],t}),{})},typecast:function(e,t,r){var n={};switch(e||t.type){case"integer":case"number":if(void 0!==t.minimum&&(n.minimum=t.minimum),void 0!==t.maximum&&(n.maximum=t.maximum),t.enum){var a=Math.max(n.minimum||0,0),i=Math.min(n.maximum||1/0,1/0);t.exclusiveMinimum&&a===t.minimum&&(a+=t.multipleOf||1),t.exclusiveMaximum&&i===t.maximum&&(i-=t.multipleOf||1),(a||i!==1/0)&&(t.enum=t.enum.filter((function(e){return e>=a&&e<=i})))}break;case"string":n.minLength=U("minLength")||0,n.maxLength=U("maxLength")||Number.MAX_SAFE_INTEGER,void 0!==t.minLength&&(n.minLength=Math.max(n.minLength,t.minLength)),void 0!==t.maxLength&&(n.maxLength=Math.min(n.maxLength,t.maxLength))}var o=r(n);if(null==o)return null;switch(e||t.type){case"number":o=parseFloat(o);break;case"integer":o=parseInt(o,10);break;case"boolean":o=!!o;break;case"string":o=String(o);for(var s,u=Math.max(n.minLength||0,0),l=Math.min(n.maxLength||1/0,1/0);o.length<u&&(s=o,t.pattern?o+=ve.randexp(t.pattern):o+=""+ve.pick([" ","/","_","-","+","=","@","^"])+o,o!==s););switch(o.length>l&&(o=o.substr(0,l)),t.format){case"date-time":case"datetime":o=new Date(o).toISOString().replace(/([0-9])0+Z$/,"$1Z");break;case"date":o=new Date(o).toISOString().substr(0,10);break;case"time":o=new Date("1969-01-01 "+o).toISOString().substr(11)}}return o},merge:be,clone:function e(t,r){if(void 0===r&&(r=new Map),!t||"object"!=typeof t)return t;if(r.has(t))return r.get(t);if(Array.isArray(t)){var n=[];return r.set(t,n),n.push.apply(n,t.map((function(t){return e(t,r)}))),n}var a={};return r.set(t,a),Object.keys(t).reduce((function(n,a){return n[a]=e(t[a],r),n}),a)},short:function(e){var t=JSON.stringify(e),r=JSON.stringify(e,null,2);return t.length>400?r.substr(0,400)+"...":r},notValue:function(e,t){var r=be({},t);if(void 0!==e.minimum&&(r.maximum=e.minimum,r.exclusiveMaximum=!0),void 0!==e.maximum&&(r.minimum=e.maximum>r.maximum?0:e.maximum,r.exclusiveMinimum=!0),void 0!==e.minLength&&(r.maxLength=e.minLength),void 0!==e.maxLength&&(r.minLength=e.maxLength>r.maxLength?0:e.maxLength),e.type)r.type=ve.pick(G.SCALAR_TYPES.filter((function(t){return(Array.isArray(e.type)?e.type:[e.type]).every((function(e){return"number"===t||"integer"===t?"number"!==e&&"integer"!==e:t!==e}))})));else if(e.enum){var n;do{n=xe()}while(-1!==e.enum.indexOf(n));r.enum=[n]}return e.required&&r.properties&&e.required.forEach((function(e){delete r.properties[e]})),r},anyValue:xe,validate:function(e,t){return!t.every((function(t){return we(e,t)}))},validateValueForSchema:we,validateValueForOneOf:function(e,t){return 1===t.reduce((function(t,r){return t+(we(e,r)?1:0)}),0)},isKey:function(e){return["enum","const","default","examples","required","definitions","items","properties"].includes(e)},template:function e(t,r){return Array.isArray(t)?t.map((function(t){return e(t,r)})):("string"==typeof t&&(t=t.replace(/#\{([\w.-]+)\}/g,(function(e,t){return r[t]}))),t)},shouldClean:Ee,clean:function e(t,r,n){return void 0===n&&(n=!1),t&&"object"==typeof t?Array.isArray(t)?t.map((function(t){return e(t,r,!0)})).filter((function(e){return void 0!==e})):(Object.keys(t).forEach((function(n){if(Oe(t[n]))Ee(n,r)&&delete t[n];else{var a=e(t[n],r);Oe(a)||(t[n]=a)}void 0===t[n]&&delete t[n]})),Object.keys(t).length||!n?t:void 0):t},isEmpty:Oe};var je=function(){this.registry={},this.support={}};je.prototype.reset=function(e){e?(delete this.registry[e],delete this.support[e]):(this.registry={},this.support={})},je.prototype.extend=function(e,t){var r,n=this;this.registry[e]=t(this.registry[e]),this.support[e]||(this.support[e]=(r=function(){return n.registry[e]},function(e,t,n,a){var i=e,o=[];"object"==typeof e&&(i=Object.keys(e)[0],Array.isArray(e[i])?o=e[i]:o.push(e[i]));for(var s=i.split("."),u=r();s.length>1;)u=u[s.shift()];return"function"==typeof(e="object"==typeof u?u[s[0]]:u)&&(e=e.apply(u,o.map((function(e){return Fe.template(e,a)})))),"[object Object]"===Object.prototype.toString.call(e)&&Object.keys(e).forEach((function(t){if("function"==typeof e[t])throw new Error("Cannot resolve value for '"+n+": "+i+"', given: "+e)})),e}))},je.prototype.define=function(e,t){this.support[e]=t},je.prototype.get=function(e){if(void 0===this.registry[e])throw new ReferenceError("'"+e+"' dependency doesn't exist.");return this.registry[e]},je.prototype.wrap=function(e){for(var t=this,r=Object.keys(e),n={},a=r.length,i=function(){var i=r[a].replace(/^x-/,""),o=t.support[i];if("function"==typeof o)return Object.defineProperty(e,"generate",{configurable:!1,enumerable:!1,writable:!1,value:function(t){return o.call(n,e[r[a]],e,r[a],t)}}),"break"};a--;){if("break"===i())break}return e};var ke=new H;function Ae(e,t){if(void 0===e)return ke.list();if("string"==typeof e)if("function"==typeof t)ke.register(e,t);else{if(null!==t&&!1!==t)return ke.get(e);ke.unregister(e)}else ke.registerMany(e)}var Pe=function(e){function t(t,r){e.call(this),e.captureStackTrace&&e.captureStackTrace(this,this.constructor),this.name="ParseError",this.message=t,this.path=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),_e={array:["additionalItems","items","maxItems","minItems","uniqueItems"],integer:["exclusiveMaximum","exclusiveMinimum","maximum","minimum","multipleOf"],object:["additionalProperties","dependencies","maxProperties","minProperties","patternProperties","properties","required"],string:["maxLength","minLength","pattern","format"]};_e.number=_e.integer;var Re=["additionalItems","items","additionalProperties","dependencies","patternProperties","properties"];function Se(e,t,r){return Object.keys(e).filter((function(e){var n=Re.indexOf(t)>-1;return!(!(r.indexOf(e)>-1)||n)})).length>0}var De=function(){return U("random")()>.5};var Ce=function(){return null};function Ie(e){var t=void 0===e.minimum?G.MIN_INTEGER:e.minimum,r=void 0===e.maximum?G.MAX_INTEGER:e.maximum,n=e.multipleOf;if(n&&(r=Math.floor(r/n)*n,t=Math.ceil(t/n)*n),e.exclusiveMinimum&&t===e.minimum&&(t+=n||1),e.exclusiveMaximum&&r===e.maximum&&(r-=n||1),t>r)return NaN;if(n){if(-1===String(n).indexOf(".")){for(var a=ve.number(Math.floor(t/n),Math.floor(r/n))*n;a<t;)a+=e.multipleOf;return a}var i,o,s=(r-t)/n;do{o=(i=ve.number(0,s)*n)/n%1}while(0!==o);return t+i}return ve.number(t,r,void 0,void 0,!0)}var Me="Lorem ipsum dolor sit amet consectetur adipisicing elit sed do eiusmod tempor incididunt ut labore\net dolore magna aliqua Ut enim ad minim veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea\ncommodo consequat Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\npariatur Excepteur sint occaecat cupidatat non proident sunt in culpa qui officia deserunt mollit anim id est\nlaborum".split(/\W/);function Te(e){return ve.shuffle(Me).slice(0,e)}var Ne={type:["string","number","integer","boolean"]};function $e(){return Te(ve.number(1,5)).join(" ")}function qe(e,t){void 0===e&&(e=0),void 0===t&&(t=140);for(var r=Math.max(0,e),n=ve.number(r,t),a=$e();a.length<r;)a+=$e();return a.length>n&&(a=a.substr(0,n)),a}function Le(){return ve.date().toISOString()}var Be="https?://{hostname}(?:[a-zA-Z][a-zA-Z0-9+-.]*)+",He={email:"[a-zA-Z\\d][a-zA-Z\\d-]{1,13}[a-zA-Z\\d]@{hostname}",hostname:"[a-zA-Z]{1,33}\\.[a-z]{2,4}",ipv6:"[a-f\\d]{4}(:[a-f\\d]{4}){7}",uri:Be,slug:"[a-zA-Z\\d_-]+","uri-reference":Be+"(?:\\?([a-z]{1,7}(=\\w{1,5})?&){0,3})?","uri-template":Be.replace("(?:","(?:/\\{[a-z][:a-zA-Z0-9-]*\\}|"),"json-pointer":"(/(?:"+"[a-zA-Z][a-zA-Z0-9+-.]*".replace("]*","/]*")+"|~[01]))+",uuid:"^[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$"};He.iri=He["uri-reference"],He["iri-reference"]=He["uri-reference"],He["idn-email"]=He.email,He["idn-hostname"]=He.hostname;var Ve=new RegExp("\\{("+Object.keys(He).join("|")+")\\}");function Je(e,t){var r,n=Ae(e.format);if("function"==typeof n)return n(e);switch(e.format){case"date-time":case"datetime":return Le();case"date":return Le().slice(0,10);case"time":return Le().slice(11);case"ipv4":return[0,0,0,0].map((function(){return ve.number(0,255)})).join(".");case"regex":return".+?";case"email":case"hostname":case"ipv6":case"uri":case"uri-reference":case"iri":case"iri-reference":case"idn-email":case"idn-hostname":case"json-pointer":case"slug":case"uri-template":case"uuid":return r=e.format,ve.randexp(He[r]).replace(Ve,(function(e,t){return ve.randexp(He[t])}));default:if(void 0===n){if(U("failOnInvalidFormat"))throw new Error("unknown registry key "+Fe.short(e.format));return t()}throw new Error("unsupported format '"+e.format+"'")}}var Ue={boolean:De,null:Ce,array:function(e,t,r,n){var a=[];if(!e.items&&!e.additionalItems){if(Fe.hasProperties(e,"minItems","maxItems","uniqueItems"))throw new Pe("missing items for "+Fe.short(e),t);return a}if(Array.isArray(e.items))return e.items.map((function(e,a){var i=t.concat(["items",a]);return n(e,i,r)}));var i=e.minItems,o=e.maxItems,s=U("minItems"),u=U("maxItems");s&&(i=void 0===i?s:Math.min(s,i)),u&&((o=void 0===o?u:Math.min(u,o))&&o>u&&(o=u),i&&i>u&&(i=o));var l=!0===U("alwaysFakeOptionals")?1:U("optionalsProbability"),c=U("alwaysFakeOptionals")||U("fixedProbabilities")||!1,p=ve.number(i,o,1,5);null!==l&&(p=Math.max(c?Math.round((o||p)*l):Math.abs(ve.number(i,o)*l),i||0));for(var f="object"==typeof e.additionalItems?e.additionalItems:{},h=a.length;h<p;h+=1){var d=t.concat(["items",h]),m=n(e.items||f,d,r);a.push(m)}return e.uniqueItems?function(e,t,r,n,a,i){var o=[],s=[];function u(e){var t=JSON.stringify(e);return-1===s.indexOf(t)&&(s.push(t),o.push(e),!0)}t.forEach(u);for(var l=100;o.length!==t.length&&(u(i(r.items||n,e,a))||(l-=1),l););return o}(t.concat(["items"]),a,e,f,r,n):a},integer:function(e){return Ie(Object.assign({multipleOf:1},e))},number:Ie,object:function(e,t,r,n){var a={},i=e.properties||{},o=e.patternProperties||{},s="boolean"==typeof e.required?[]:(e.required||[]).slice(),u=!1!==e.additionalProperties,l=Object.keys(i),c=Object.keys(o),p=l.concat(c).reduce((function(e,t){return-1===s.indexOf(t)&&e.push(t),e}),[]),f=s.concat(p),h=u&&!0===e.additionalProperties?Ne:e.additionalProperties;if(!u&&0===l.length&&0===c.length&&Fe.hasProperties(e,"minProperties","maxProperties","dependencies","required"))return null;if(!0===U("requiredOnly"))return s.forEach((function(e){i[e]&&(a[e]=i[e])})),n(a,t.concat(["properties"]),r,e);var d=!0===U("alwaysFakeOptionals")?1:U("optionalsProbability"),m=U("alwaysFakeOptionals")||U("fixedProbabilities")||!1,y=U("ignoreProperties")||[],g=U("reuseProperties"),v=U("fillProperties"),b=e.maxProperties||f.length+(u?ve.number(1,5):0),x=Math.max(e.minProperties||0,s.length),w=Math.max(0,f.length-x);1!==f.length||s.length||(x=Math.max(ve.number(v?1:0,b),x)),null!==d&&(w=!0===m?Math.round(x-s.length+d*(f.length-x)):ve.number(x-s.length,d*(f.length-x)));var O=ve.shuffle(p).slice(0,w),E=p.filter((function(e){return-1!==O.indexOf(e)})),F=null!==d?b:ve.number(0,b),j=s.concat(ve.shuffle(E).slice(0,F)),k=[];if(e.dependencies&&(Object.keys(e.dependencies).forEach((function(t){var r=e.dependencies[t];-1!==j.indexOf(t)&&(Array.isArray(r)?r.forEach((function(e){-1===j.indexOf(e)&&j.push(e)})):k.push(r))})),k.length))return delete e.dependencies,n({allOf:k.concat(e)},t.concat(["properties"]),r,e);var A=[];j.forEach((function(e){for(var t=0;t<y.length;t+=1)if(y[t]instanceof RegExp&&y[t].test(e)||"string"==typeof y[t]&&y[t]===e||"function"==typeof y[t]&&y[t](i[e],e))return void A.push(e);var r;if(!1===h&&-1!==s.indexOf(e)&&(a[e]=i[e]),i[e]&&(a[e]=i[e]),c.forEach((function(t){e.match(new RegExp(t))&&(r=!0,a[e]?Fe.merge(a[e],o[t]):a[ve.randexp(e)]=o[t])})),!r){var n=o[e]||h;n&&!1!==h&&(a[o[e]?ve.randexp(e):e]=i[e]||n)}}));var P=Object.keys(a).length+(v?0:A.length);function _(e){var t;do{if(!e.length)break;t=e.shift()}while(a[t]);return t}var R,S=x;for(u&&!s.length&&(S=Math.max(null===d||h?ve.number(v?1:0,b):0,x));v&&(c.length||u)&&!(P>=S);){if(u)if(g&&l.length-P>S){var D=0,C=void 0;do{if((D+=1)>1e3)break;C=_(s)||ve.pick(l)}while(void 0!==a[C]);void 0===a[C]&&(a[C]=i[C],P+=1)}else if(c.length&&!h){var I=ve.pick(c),M=ve.randexp(I);a[M]||(a[M]=o[I],P+=1)}else{var T=_(s)||Te(1)+(R=void 0,ve.randexp("_?[_a-f\\d]{1,3}"+(R?"\\$?":"")));a[T]||(a[T]=h||Ne,P+=1)}for(var N=0;P<x&&N<c.length;N+=1){var $=c[N],q=ve.randexp($);a[q]||(a[q]=o[$],P+=1)}}if(0===s.length&&(!u||!1===d))for(var L=ve.number(x,b);P<L;){var B=_(l);B&&(a[B]=i[B]),P+=1}return n(a,t.concat(["properties"]),r,e)},string:function(e){return Fe.typecast("string",e,(function(t){return e.format?Je(e,(function(){return qe(t.minLength,t.maxLength)})):e.pattern?ve.randexp(e.pattern):qe(t.minLength,t.maxLength)}))}};function ze(e,t,r,n){if(e=r(e,null,t)){if("properties"!==t[t.length-1]){if(U("useExamplesValue")&&Array.isArray(e.examples)){var a=e.examples.concat("default"in e?[e.default]:[]);return Fe.typecast(null,e,(function(){return ve.pick(a)}))}if(U("useDefaultValue")&&"default"in e&&(""!==e.default||!U("replaceEmptyByRandomValue")))return e.default;if("template"in e)return Fe.template(e.template,n);if("const"in e)return e.const}if(e.not&&"object"==typeof e.not&&(e=Fe.notValue(e.not,Fe.omitProps(e,["not"]))).type&&"object"===e.type){var i=ze(e,t.concat(["not"]),r,n);return Fe.clean(i,e,!1)}if("function"==typeof e.thunk)return ze(e.thunk(n),t,r);if("function"==typeof e.generate)return Fe.typecast(null,e,(function(){return e.generate(n)}));if("string"==typeof e.pattern)return Fe.typecast("string",e,(function(){return ve.randexp(e.pattern)}));if(Array.isArray(e.enum))return Fe.typecast(null,e,(function(){return ve.pick(e.enum)}));if(e.jsonPath)return e;var o=e.type;if(Array.isArray(o)?o=ve.pick(o):void 0===o&&(o=function(e,t){for(var r=Object.keys(_e),n=0;n<r.length;n+=1){var a=r[n];if(Se(e,t[t.length-1],_e[a]))return a}}(e,t)||o)&&(e.type=o),"string"==typeof o){if(!Ue[o]){if(U("failOnInvalidTypes"))throw new Pe("unknown primitive "+Fe.short(o),t.concat(["type"]));var s=U("defaultInvalidTypeProduct");return"string"==typeof s&&Ue[s]?Ue[s](e,t,r,ze):s}try{return Ue[o](e,t,r,ze)}catch(e){if(void 0===e.path)throw new Pe(e.stack,t);throw e}}var u={};return Array.isArray(e)&&(u=[]),Object.keys(e).forEach((function(n){if("object"==typeof e[n]&&"definitions"!==n){var a=ze(e[n],t.concat([n]),r,u);u[n]=Fe.clean(a,e[n],!1)}else u[n]=e[n]})),u}}function Ge(e,t,r,n){if(!e||"object"!=typeof e)return e;if(r||(r={}),t||(t=e),Array.isArray(e))return e.map((function(e){return Ge(e,t,r,n)}));if(e.jsonPath){var a="object"!=typeof e.jsonPath?{path:e.jsonPath}:e.jsonPath;a.group=e.group||a.group||n,a.cycle=e.cycle||a.cycle||!1,a.reverse=e.reverse||a.reverse||!1,a.count=e.count||a.count||1;var i=a.group+"__"+a.path;return r[i]||(a.count>1?r[i]=B(a.path,t).slice(0,a.count):r[i]=B(a.path,t)),a.cycle||a.reverse?function(e,t){if(!Array.isArray(e))return e;var r=t?e.pop():e.shift();return t?e.unshift(r):e.push(r),r}(r[i],a.reverse):function(e){return Array.isArray(e)?ve.pick(e):e}(r[i])}return Object.keys(e).forEach((function(n){e[n]=Ge(e[n],t,r,n)})),e}function Ze(e,t,r){if("[object Object]"!==Object.prototype.toString.call(t))throw new Error("Invalid input, expecting object but given "+typeof t);var n=U("refDepthMin")||0,a=U("refDepthMax")||3;try{var i=function(e){var t,r=e.refs,n=e.schema,a=e.container,i=e.refDepthMax,o=e.refDepthMin,s={},u={},l=0;return s.resolveSchema=function(e,c,p){if(null==e)return null;if("function"==typeof e.generate)return e;if("string"==typeof(e.$id||e.id)&&(delete e.id,delete e.$id,delete e.$schema),"string"==typeof e.$ref){var f,h=Math.max(o,i)-1;if("#"===e.$ref||u[e.$ref]<0||t===e.$ref&&++l>h)return delete e.$ref,e;if(void 0===u[e.$ref]&&(u[e.$ref]=ve.number(o,i)-1),t=e.$ref,void 0!==(f=-1===e.$ref.indexOf("#/")?r[e.$ref]||null:Fe.getLocalRef(n,e.$ref)||null)){if(!f&&!0!==U("ignoreMissingRefs"))throw new Error("Reference not found: "+e.$ref);u[e.$ref]-=1,Fe.merge(e,f||{})}return delete e.$ref,e}if(Array.isArray(e.allOf)){var d=e.allOf;delete e.allOf,d.forEach((function(t){var r=s.resolveSchema(t,null,p);Fe.merge(e,"function"==typeof r.thunk?r.thunk(e):r),Array.isArray(e.allOf)&&s.resolveSchema(e,c,p)}))}if(Array.isArray(e.oneOf||e.anyOf)){var m=e.oneOf||e.anyOf;return e.enum&&e.oneOf&&(e.enum=e.enum.filter((function(e){return Fe.validate(e,m)}))),{thunk:function(t){var r=Fe.omitProps(e,["anyOf","oneOf"]),n=ve.pick(m);return Fe.merge(r,n),m.forEach((function(e){e.required&&e!==n&&e.required.forEach((function(e){var n=r.required&&r.required.includes(e);r.properties&&!n&&delete r.properties[e],t&&t.properties&&delete t.properties[e]}))})),r}}}if(Object.keys(e).forEach((function(t){!Array.isArray(e[t])&&"object"!=typeof e[t]||Fe.isKey(t)||(e[t]=s.resolveSchema(e[t],t,p.concat(t)))})),p){var y=p[p.length-1];if("properties"===y||"items"===y)return e}return a.wrap(e)},s}({refs:e,schema:t,container:r,refDepthMin:n,refDepthMax:a}).resolveSchema,o=ze(Fe.clone(t),[],i);return U("resolveJsonPath")?Ge(o):o}catch(e){throw e.path?new Error(e.message+" in /"+e.path.join("/")):e}}var Xe=new je;function Ye(){Xe.define("autoIncrement",(function(e,t){if(!this.offset){var r=t.minimum||1,n=r+G.MAX_NUMBER,a=e.initialOffset||t.initialOffset;this.offset=a||ve.number(r,n)}return!0===e?this.offset++:t})),Xe.define("sequentialDate",(function(e,t){if(this.now||(this.now=ve.date()),e){if(t=this.now.toISOString(),-1===["seconds","minutes","hours","days","weeks","months","years"].indexOf(e=!0===e?"days":e))throw new Error("Unsupported increment by "+Fe.short(e));this.now.setTime(this.now.getTime()+ve.date(e))}return t}))}function We(e,t){var r={};function n(e){if(e&&"object"==typeof e){if(Array.isArray(e))return e.forEach(n);var t=e.$id||e.id;"string"!=typeof t||r[t]||(r[t]=e),Object.keys(e).forEach((function(t){n(e[t])}))}}return Array.isArray(e)?e.forEach((function(e){r[e.$id||e.id]=e})):r=e||{},n(e),n(t),r}var Ke=function(e,t,r){return console.log("[json-schema-faker] calling JsonSchemaFaker() is deprecated, call either .generate() or .resolve()"),r&&console.log("[json-schema-faker] references are only supported by calling .resolve()"),Ke.generate(e,t)};Ke.generate=function(e,t){return Ze(We(t,e),e,Xe)},Ke.resolve=function(e,t,r){"string"==typeof t&&(r=t,t={}),r=(r=r||("undefined"!=typeof process?process.cwd():"")).replace(/\/+$/,"")+"/";var n=We(t,e),a={order:1,canRead:function(e){var t=e.url.replace("/:",":");return n[t]||n[t.split("/").pop()]},read:function(e,t){try{t(null,this.canRead(e))}catch(e){t(e)}}};return b.default.dereference(r,e,{resolve:{file:{order:100},http:{order:200},fixedRefs:a},dereference:{circular:"ignore"}}).then((function(e){return Ze(n,e,Xe)})).catch((function(e){throw new Error("Error while resolving schema ("+e.message+")")}))},Ye(),Ke.format=Ae,Ke.option=U,Ke.random=ve,Ke.extend=function(e,t){return Xe.extend(e,t),Ke},Ke.define=function(e,t){return Xe.define(e,t),Ke},Ke.reset=function(e){return Xe.reset(e),Ye(),Ke},Ke.locate=function(e){return Xe.get(e)},"undefined"!=typeof VERSION&&(Ke.version=VERSION);const Qe=e=>e.substr("-"===e[1]?2:1),et=e=>{const t=Number.parseFloat(e);if(!isNaN(t))return t;const r=e.toLowerCase();return"true"===r||"false"!==r&&e};var tt=(e=>{"string"==typeof e&&(e=["","",...e.split(" ").filter((e=>e))]),e=(e=e.reduce(((e,t)=>("="!==t&&(t.includes("=")?e.push(...t.split("=")):e.push(t)),e)),[])).reduce(((e,t)=>(t.length>2&&"-"===t[0]&&"-"!==t[1]&&isNaN(Number.parseFloat(t))?t.substr(1,t.length-1).split("").forEach((t=>{e.push(`-${t}`,"true")})):e.push(t),e)),[]);const t={_:[]};for(let r=2;r<e.length;r++){const n=e[r];if("-"===n[0]&&isNaN(Number.parseFloat(n))){const a=n.indexOf("=");if(-1===a){const e=Qe(n);"no-"!==e.substr(0,3).toLowerCase()?t[e]=!0:t[e.substr(3,e.length)]=!1}else{const i=n.substr(0,a);e[r]=i,t[Qe(i)]=null,e.splice(r+1,0,n.substr(a+1,n.length))}}else{const a=e[r-1];"-"===a[0]?t[Qe(a)]=et(n):t._.push(et(n))}}return t})(process.argv);var rt=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e,t){var r=(t=e.exports=function e(){for(var r,n,a=500,i={},o=0;o<arguments.length;o++){var s=arguments[o];if(s instanceof Error)a=(r=s).status||r.statusCode||a;else switch(typeof s){case"string":n=s;break;case"number":a=s;break;case"object":i=s}}"number"==typeof a&&j.default[a]||(a=500);var u=t[a];for(var l in r||(r=u?new u(n):new Error(n||j.default[a]),Error.captureStackTrace(r,e)),u&&r instanceof u||(r.expose=a<500,r.status=r.statusCode=a),i)"status"!==l&&"statusCode"!==l&&(r[l]=i[l]);return r}).HttpError=function(){throw new TypeError("cannot construct abstract class")};k.default(r,Error),j.default.codes.filter((function(e){return e>=400})).forEach((function(e){var n=j.default[e].split(" ").map((function(e){return e.slice(0,1).toUpperCase()+e.slice(1)})).join("").replace(/[^ _0-9a-z]/gi,""),a=n.match(/Error$/)?n:n+"Error";if(e>=500){var i=function t(r){var n=new Error(null!=r?r:j.default[e]);return Error.captureStackTrace(n,t),n.__proto__=t.prototype,Object.defineProperty(n,"name",{enumerable:!1,configurable:!0,value:a,writable:!0}),n};return k.default(i,r),i.prototype.status=i.prototype.statusCode=e,i.prototype.expose=!1,void(t[e]=t[n]=i)}var o=function t(r){var n=new Error(null!=r?r:j.default[e]);return Error.captureStackTrace(n,t),n.__proto__=t.prototype,Object.defineProperty(n,"name",{enumerable:!1,configurable:!0,value:a,writable:!0}),n};k.default(o,r),o.prototype.status=o.prototype.statusCode=e,o.prototype.expose=!0,t[e]=t[n]=o})),t["I'mateapot"]=t.ImATeapot}));function nt(e){try{return decodeURIComponent(e)}catch(t){throw rt(400,'failed to decode param "'+e+'"')}}const at=({mockResponses:e,statusCode:t})=>null==e?void 0:e.responses.find((({statusCode:e})=>e===t)),it=({pathOverrides:e,refs:t,apiDoc:r,debugRequest:n,debugResponse:a})=>(i,o)=>{n("Received:\n"+JSON.stringify({url:i.url,params:i.params,headers:i.headers,body:i.body},null,2));const s=(({pathOverrides:e,url:t})=>{if(!e.length)return;let r;return r=at({statusCode:200,mockResponses:e.find((({request:{path:e}})=>e===t))}),r||(r=at({statusCode:200,mockResponses:e[0]})),r})({url:i.url,pathOverrides:e});if(s)return a("Response:\n"+JSON.stringify({statusCode:200,headers:s.headers,body:s.body},null,2)),void o.status(200).set(s.headers).json(s.body);const u=(({openapi:e,refs:t,apiDoc:r})=>{var n;if(!e)return{statusCode:500,body:{message:"No openapi definition found!"}};const a=e.schema.responses[200];if(!a)return{statusCode:500,body:{message:"No 200 response found!"}};let i={};try{i=t.get(a.$ref)}catch(e){i=a}try{const e=null===(n=null==i?void 0:i.content["application/json"])||void 0===n?void 0:n.schema;return{statusCode:200,body:Ke.generate(Object.assign(Object.assign({},e),{components:r.components}))}}catch(e){return{statusCode:500,body:{message:"No json schema found!"}}}})({openapi:i.openapi,refs:t,apiDoc:r});a("Response:\n"+JSON.stringify({statusCode:u.statusCode,body:u.body},null,2)),o.status(u.statusCode).json(u.body)},ot=({overridesFile:e,requestMethod:t,expressRoute:r})=>{if(!e)return[];const n=(a=(a={sensitive:!1,strict:!1,end:!1})||{},function(e){var t=[],r=F.default(e,t,a);return function(e,n){var a,i,o=r.exec(e);if(!o)return!1;n=n||{};for(var s=0;s<t.length;s++)a=t[s],(i=o[s+1])&&(n[a.name]=nt(i),a.repeat&&(n[a.name]=n[a.name].split(a.delimiter)));return n}});var a;return n(r),t=t.toLocaleLowerCase(),e.routes.filter((({request:{path:e,method:r}})=>n(e)&&r===t))};var st={type:"object",properties:{port:{type:"integer",default:8080},validateRequests:{type:"boolean",default:!1},validateResponses:{type:"boolean",default:!1},openapiDefinition:{type:"string"},validateFormats:{anyOf:[{type:"string",enum:["fast","full"]},{type:"boolean",enum:[!1]}]},unknownFormats:{anyOf:[{type:"string",enum:["ignore"]},{type:"boolean",enum:[!0]},{type:"array",items:{type:"string"}}]}},additionalProperties:!1},ut={type:"object",properties:{defaultInvalidTypeProduct:{type:"string",default:"null"},defaultRandExpMax:{type:"integer",default:10},ignoreProperties:{type:"array",items:{type:"string"},default:[]},ignoreMissingRefs:{type:"boolean",default:!1},failOnInvalidTypes:{type:"boolean",default:!0},failOnInvalidFormat:{type:"boolean",default:!0},alwaysFakeOptionals:{type:"boolean",default:!1},optionalsProbability:{type:"number",multipleOf:.1,minimum:0,maximum:1},fixedProbabilities:{type:"boolean",default:!1},useExamplesValue:{type:"boolean",default:!1},useDefaultValue:{type:"boolean",default:!1},requiredOnly:{type:"boolean",default:!1},minItems:{type:"number",multipleOf:1,default:0},maxItems:{type:"number",multipleOf:1,default:null},minLength:{type:"number",multipleOf:1,default:0},maxLength:{type:"number",multipleOf:1,default:null},refDepthMin:{type:"number",multipleOf:1,default:0},refDepthMax:{type:"number",multipleOf:1,default:3},resolveJsonPath:{type:"boolean",default:!1},reuseProperties:{type:"boolean",default:!1},fillProperties:{type:"boolean",default:!0},replaceEmptyByRandomValue:{type:"boolean",default:!0}},additionalProperties:!1},lt={type:"object",properties:{routes:{type:"array",items:{type:"object",properties:{request:{type:"object",properties:{path:{type:"string"},method:{type:"string",enum:["get","post","put","delete"]}},additionalProperties:!1,required:["path","method"]},responses:{type:"array",items:{type:"object",properties:{statusCode:{type:"integer"},headers:{type:"object"},body:{type:"object"}},additionalProperties:!1,required:["statusCode"]}}},additionalProperties:!1,required:["request","responses"]}}},additionalProperties:!1,required:["routes"]};const ct=E.default("mock"),pt=({filePath:e,defaultFileName:t,jsonSchema:r})=>A(void 0,void 0,void 0,(function*(){const n=(({filePath:e,defaultFileName:t})=>e?[e]:["ts","js","json"].map((e=>`${t}.${e}`)))({filePath:e,defaultFileName:t}),a=yield(({paths:e,jsonSchema:t})=>A(void 0,void 0,void 0,(function*(){let r;for(const t of e)try{const{default:e}=yield Promise.resolve().then((function(){return m(require(s.join(process.cwd(),t)))}));r=e,ct(`Imported file ${s.join(process.cwd(),t)}\n${JSON.stringify(r,null,2)}`);break}catch(e){}if(!t){const e=(new h.Validator).validate(r,t);if(!e.valid)throw Error(JSON.stringify(e.errors,null,2))}return r})))({paths:n,jsonSchema:r});if(e&&!a)throw Error(`${s.join(process.cwd(),e)} not found!`);return a})),ft=({filePath:e})=>A(void 0,void 0,void 0,(function*(){return yield pt({filePath:e,defaultFileName:"mock-config",jsonSchema:{type:"object",properties:{express:st,jsf:ut},additionalProperties:!1}})})),ht=e=>Object.entries(e).map((([e,t])=>(delete t.security,{[e]:t}))).reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{}),dt=E.default("mock"),mt={express:{port:tt.port||8080,validateRequests:!1,validateResponses:!1,openapiDefinition:tt.openapiDefinition,unknownFormats:"ignore"},jsf:{fillProperties:!1,useExamplesValue:!0,useDefaultValue:!0,failOnInvalidFormat:!1,refDepthMax:5}};A(void 0,void 0,void 0,(function*(){const e=yield ft({filePath:tt["mock-config"]}),r=yield(({filePath:e})=>A(void 0,void 0,void 0,(function*(){return yield pt({filePath:e,defaultFileName:"mock-overrides",jsonSchema:lt})})))({filePath:tt["mock-overrides"]});e&&(e=>{Object.entries(e).forEach((([e,t])=>{mt[e]=Object.assign(Object.assign({},mt[e]),t)}))})(e),dt(`Mock Server Config:\n${JSON.stringify(mt,null,2)}`);const{express:n,express:{port:a,openapiDefinition:i},jsf:o}=mt;if(delete n.port,delete n.openapiDefinition,!i)throw Error("No openapi definition");Ke.option(Object.assign({},o));const u=O.default.isWebUri(i)?(yield x.default.get(i)).data:require(s.join(process.cwd(),i));var l;u.paths=(l=u.paths,Object.entries(l).map((([e,t])=>({[e]:ht(t)}))).reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{}));const c=yield g.default.resolve(u),p=y.default();p.use(w.default()),p.use(v.default.json()),p.use(t.middleware(Object.assign(Object.assign({apiSpec:u},n),{operationHandlers:{basePath:"",resolver:(e,t,n)=>(({refs:e,apiDoc:t,overridesFile:r,route:n})=>{const a=E.default("mock-request"),i=E.default("mock-response"),o=ot({overridesFile:r,requestMethod:n.method,expressRoute:n.expressRoute});return it({pathOverrides:o,refs:e,apiDoc:t,debugRequest:a,debugResponse:i})})({refs:c,apiDoc:n,overridesFile:r,route:t})}}))),p.listen(a,(()=>dt(`Listening on port: ${a}`)))})).catch((e=>dt(e)));
